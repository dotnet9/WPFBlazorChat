ä¾ç„¶ä½¿ç”¨ä¸Šé¢çš„å·¥ç¨‹ï¼Œæ·»åŠ Blazoræ”¯æŒï¼Œæ­¤éƒ¨åˆ†å‚è€ƒå¾®è½¯æ–‡æ¡£[ç”Ÿæˆ Windows Presentation Foundation (WPF) Blazor åº”ç”¨](https://learn.microsoft.com/zh-cn/aspnet/core/blazor/hybrid/tutorials/wpf?view=aspnetcore-7.0)ï¼Œæœ¬å°èŠ‚å¿«é€Ÿç•¥è¿‡ã€‚

### 2.1 ç¼–è¾‘å·¥ç¨‹æ–‡ä»¶`WPFBlazorChat.csproj`

![å·¥ç¨‹æ–‡ä»¶ä¿®æ”¹å¯¹æ¯”](https://img1.dotnet9.com/2022/10/1004.png)

1. åœ¨é¡¹ç›®æ–‡ä»¶çš„é¡¶éƒ¨ï¼Œå°† SDK æ›´æ”¹ä¸º `Microsoft.NET.Sdk.Razor`ã€‚
2. æ·»åŠ èŠ‚ç‚¹`<RootNameSpace>WPFBlazorChat</RootNameSpace>`ï¼Œå°†é¡¹ç›®å‘½åç©ºé—´ `WPFBlazorChat` è®¾ç½®ä¸ºåº”ç”¨çš„æ ¹å‘½åç©ºé—´ã€‚
3. æ·»åŠ `Nuget`åŒ…`Microsoft.AspNetCore.Components.WebView.Wpf`ï¼Œç‰ˆæœ¬çœ‹ä½ é€‰æ‹©çš„`.NET`ç‰ˆæœ¬è€Œå®šã€‚

### 2.2 æ·»åŠ `_Imports.razor`æ–‡ä»¶

`_Imports.razor`æ–‡ä»¶ç±»ä¼¼ä¸€ä¸ª`Global` usingæ–‡ä»¶ï¼Œæ”¾ç½®ä¸€äº›å…¨å±€çš„å‘½åç©ºé—´ï¼Œç²¾ç®€ä»£ç ã€‚

å†…å®¹å¦‚ä¸‹ï¼Œå¼•å…¥äº†ä¸€ä¸ªå‘½åç©ºé—´`Microsoft.AspNetCore.Components.Web`ï¼Œè¿™æ˜¯Razorå¸¸ç”¨å‘½åç©ºé—´ï¼š

```html
@using Microsoft.AspNetCore.Components.Web
```

### 2.3 æ·»åŠ `wwwroot\index.html`æ–‡ä»¶

å’ŒVue\Reactä¸€æ ·ï¼Œéœ€è¦ä¸€ä¸ª`html`æ–‡ä»¶æ‰¿è½½`Razor`ç»„ä»¶ï¼Œé¡µé¢å†…å®¹ç±»ä¼¼ï¼š

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WPFBlazorChat</title>
    <base href="/" />
    <link href="css/app.css" rel="stylesheet" />
    <link href="WpfBlazor.styles.css" rel="stylesheet" />
</head>

<body>
<div id="app">Loading...</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">ğŸ—™</a>
</div>
<script src="_framework/blazor.webview.js"></script>
</body>

</html>
```

1. `app.css`ä¸‹é¢ç»™å‡ºäº†å®šä¹‰ã€‚
2. çœ‹`<div id="app">Loading...</div>`ï¼Œè¿™é‡Œæ˜¯æ‰¿è½½`Razor`ç»„ä»¶çš„åœ°æ–¹ï¼Œåé¢æ‰€æœ‰åŠ è½½çš„`Razor`ç»„ä»¶éƒ½æ˜¯åœ¨è¿™é‡Œæ¸²æŸ“å‡ºæ¥çš„ã€‚
3. å…¶ä»–æš‚æ—¶ä¸ç®¡ã€‚

### 2.4 æ·»åŠ `wwwroot\css\app.css`æ–‡ä»¶

é¡µé¢çš„åŸºæœ¬æ ·å¼ï¼Œé€šç”¨çš„æ ·å¼å¯æ”¾åœ¨è¿™ä¸ªæ–‡ä»¶ï¼š

```css
html, body {
    font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
}

h1:focus {
    outline: none;
}

a, .btn-link {
    color: #0071c1;
}

.btn-primary {
    color: #fff;
    background-color: #1b6ec2;
    border-color: #1861ac;
}

.valid.modified:not([type=checkbox]) {
    outline: 1px solid #26b050;
}

.invalid {
    outline: 1px solid red;
}

.validation-message {
    color: red;
}

#blazor-error-ui {
    background: lightyellow;
    bottom: 0;
    box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
    display: none;
    left: 0;
    padding: 0.6rem 1.25rem 0.7rem 1.25rem;
    position: fixed;
    width: 100%;
    z-index: 1000;
}

#blazor-error-ui .dismiss {
    cursor: pointer;
    position: absolute;
    right: 0.75rem;
    top: 0.5rem;
}
```

### 2.5 æ·»åŠ ä¸€ä¸ªRazorç»„ä»¶

åŠ ä¸€ä¸ªRazorçš„ç»å…¸ç»„ä»¶`Counter.razor`ï¼Œ`Blazor`çš„`Hello World`ç¨‹åºå°±æœ‰è¿™ä¹ˆä¸€ä¸ªç»„ä»¶ï¼Œæ–‡ä»¶è·¯å¾„ï¼š`/RazorViews/Counter.razor`ï¼Œä¹‹æ‰€ä»¥æ”¾`RazorViews`ç›®å½•ï¼Œæ˜¯ä¸ºäº†å’ŒWPFå¸¸ç”¨çš„`Views`ç›®å½•åŒºåˆ†ï¼Œè¯¥ç»„ä»¶å†…å®¹å¦‚ä¸‹ï¼š

```html
<h1>Counter</h1>

<p>å¥½å¼€å¿ƒï¼Œä½ ç‚¹æˆ‘äº†ï¼Œç°åœ¨æ˜¯:<span style="color: red;">@currentCount</span></p>

<button class="btn btn-primary" @onclick="IncrementCount">å¿«å¿«ç‚¹æˆ‘</button>

@code {
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }
}
```

ä¸€ä¸ªæŒ‰é’®ã€å¿«å¿«ç‚¹æˆ‘ã€‘ï¼Œç‚¹å‡»`@onclick="IncrementCount"`ä½¿å˜é‡`currentCount`è‡ªå¢ï¼ŒåŒæ—¶é¡µé¢æ˜¾ç¤ºæ­¤å˜é‡å€¼ï¼Œç›¸ä¿¡ä½ èƒ½çœ‹æ‡‚ã€‚

### 2.6 Blazorä¸WPFçª—ä½“å…³è”

è¿™æ˜¯ä¸¤è€…äº§ç”Ÿå…³ç³»çš„å…³é”®ä¸€æ­¥ï¼Œæ‰“å¼€çª—ä½“`MainWindow.xaml`ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š

![çª—ä½“Xamlä¿®æ”¹](https://img1.dotnet9.com/2022/10/1005.png)

å¦‚ä¸Šä»£ç ï¼Œè¦ç‚¹å¦‚ä¸‹ï¼š

1. æ·»åŠ ä¸Šé¢å¼•å…¥çš„`Nuget`åŒ…`Microsoft.AspNetCore.Components.WebView.Wpf`çš„å‘½åç©ºé—´ï¼Œå‘½åä¸º`blazor`ï¼Œä¸»è¦æ˜¯è¦ä½¿ç”¨`BlazorWebView`ç»„ä»¶;
2. `BlazorWebView`ç»„ä»¶å±æ€§`HostPage`æŒ‡å®šæ‰¿è½½çš„htmlæ–‡ä»¶ï¼Œ`Services`æŒ‡å®šrazorç»„ä»¶çš„Iocå®¹å™¨ï¼Œçœ‹ä¸‹é¢çš„ä»£ç ;
3. `RootComponent`çš„`Selector="#app"`å±æ€§æŒ‡ç¤º`Razor`ç»„ä»¶æ¸²æŸ“çš„ä½ç½®ï¼Œçœ‹`index.html`ä¸­idä¸º`app`çš„htmlå…ƒç´ ï¼Œ`ComponentType`æŒ‡ç¤ºéœ€è¦åœ¨`#app`ä¸­æ¸²æŸ“çš„`Razor`ç»„ä»¶ç±»å‹ã€‚

æ‰“å¼€`MainWindow.xaml.cs`ï¼Œä¿®æ”¹å¦‚ä¸‹ï¼š

![æ³¨å…¥Iocå®¹å™¨](https://img1.dotnet9.com/2022/10/1006.png)

åœ¨WPFé‡Œå¯ä»¥ä½¿ç”¨Prismç­‰æ¡†æ¶æä¾›çš„`Unity`ã€`DryIoc`ç­‰`Ioc`å®¹å™¨å®ç°è§†å›¾ä¸æœåŠ¡çš„æ³¨å…¥ï¼›`Razor`ç»„ä»¶è¿™é‡Œï¼Œé»˜è®¤ä½¿ç”¨`ASP.NET Core`çš„`IServiceCollection`å®¹å™¨ï¼›å¦‚æœWPFçª—ä½“ä¸Razorç»„ä»¶éœ€è¦å…±äº«æ•°æ®ï¼Œå¯ä»¥é€šè¿‡åé¢è¦è¯´çš„`Messager`å‘é€æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»¥é€šè¿‡`Ioc`å®¹å™¨æ³¨å…¥çš„æ–¹å¼å®ç°ï¼Œæ¯”å¦‚ä»WPFçª—ä½“ä¸­æ³¨å…¥çš„æ•°æ®ï¼ˆé€šè¿‡MainWindowæ„é€ å‡½æ•°æ³¨å…¥ï¼‰ï¼Œé€šè¿‡`IServiceCollection`å®¹å™¨å†æ³¨å…¥`Razor`ç»„ä»¶ä½¿ç”¨ï¼Œè¿™é‡Œåé¢ä¹Ÿæœ‰æåˆ°ã€‚

![WPFä¸Razorç»„ä»¶ä¹‹é—´é€šè¿‡Iocæ•°æ®ä¼ è¾“](https://img1.dotnet9.com/2022/10/1008.png)

ä¸Šé¢æ­¥éª¤åšå®Œåï¼Œè¿è¡Œç¨‹åºï¼š

![WPFé›†æˆBlazorçš„é»˜è®¤ç¨‹åºåœ¨](https://img1.dotnet9.com/2022/10/1007.gif)

OKï¼ŒWPFä¸Blazoré›†æˆæˆåŠŸï¼Œæ‰“å®Œæ”¶å·¥ï¼

ç­‰ç­‰ï¼Œè¿˜æ²¡å®Œå‘¢ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚